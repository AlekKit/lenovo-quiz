<!doctype html>
<html lang="mk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lenovo Квиз — Откриј го идеалниот Lenovo</title>
<meta name="description" content="Одговори на 8 брзи прашања и добиј директна препорака за идеален Lenovo лаптоп." />
<style>
  :root{
    --bg:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb; --card:#ffffff;
    --lenovo-red:#E2231A; --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.06);
  }
  *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* header logo centered */
  .topbar { position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid var(--border);
            width:100%; display:flex; justify-content:center; align-items:center; padding:12px 0; }
  .topbar-inner { width:100%; display:flex; justify-content:center; align-items:center; }
  .topbar-inner img { display:block; margin:0 auto; height:58px; }

  .wrap{max-width:960px;margin:0 auto;padding:20px}

  header.hero{background:#fff; padding-top:450px !important;}
  .hero-inner{
    display:flex; align-items:center; justify-content:center;
    min-height:38vh; padding:10px;
  }
  .intro-card{
    background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); width:min(820px,100%); padding:22px;
    text-align:center; margin:0 auto;
  }
  h1{font-size:24px;margin:8px 0 6px}
  .sub{color:var(--muted);margin:0 0 18px;font-size:14px}
  .start-btn{display:inline-flex;align-items:center;gap:10px;background:var(--lenovo-red);color:#fff;border:none;padding:12px 18px;border-radius:999px;cursor:pointer;font-weight:700;letter-spacing:.2px;text-transform:uppercase}

  .container{padding:18px 0 36px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow);max-width:780px;margin:0 auto}
  .progress{height:8px;border-radius:8px;background:#f3f4f6;overflow:hidden;margin:4px 0 16px}
  .progress>div{height:100%;background:var(--lenovo-red);width:0%}
  .pill{display:inline-block;background:#f8fafc;border:1px solid var(--border);color:#6b7280;border-radius:999px;padding:6px 10px;font-size:12px;margin-bottom:8px}
  .q-title{font-size:20px;margin:6px 0 14px}
  .answers{display:grid;gap:12px}
  .btn{border:1px solid var(--border);background:#fff;color:var(--text);padding:14px 14px;border-radius:12px;font-weight:600;cursor:pointer;text-align:left;display:flex;align-items:center;gap:12px;transition:transform .03s ease, border-color .15s ease, box-shadow .15s ease, background .15s ease}
  .btn:hover{border-color:#c9ced6;box-shadow:0 4px 14px rgba(17,24,39,.06)}
  .btn.primary{display:inline-flex;align-items:center;justify-content:center;text-align:center;background:var(--lenovo-red);color:#fff;border:0}
  .icon{display:inline-flex;width:22px;height:22px;color:var(--lenovo-red)}
  .icon svg{width:22px;height:22px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .field{flex:1 1 220px;display:flex;flex-direction:column;gap:6px}
  input[type="text"],input[type="email"],input[type="tel"]{background:#fff;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:12px 12px;font-size:15px}
  label.consent{display:flex;align-items:flex-start;gap:10px;color:#374151;font-size:14px;margin:8px 0 10px}
  input[type="checkbox"]{transform:translateY(2px)}
  .error{color:#dc2626;font-size:13px;margin-top:4px;display:none}
  .hidden{display:none !important}
  .grid-2{grid-template-columns:1fr}
  @media(min-width:720px){ .grid-2{grid-template-columns:repeat(2,1fr)} }

  /* hero image center */
  .hero-img{
    width:100%; max-width:780px; margin:0 auto 14px auto;
    border-radius:14px; overflow:hidden; border:1px solid var(--border);
    display:flex; align-items:center; justify-content:center;
  }
  .hero-img img{ display:block; max-width:100%; height:auto; margin:0 auto; }

  .preview{margin-top:12px; display:flex; gap:12px; align-items:center; border:1px solid var(--border); padding:12px; border-radius:12px; background:#fafafa}
  .preview img{width:88px;height:88px;object-fit:cover;border-radius:10px;border:1px solid #e5e7eb;background:#fff}
  .preview .meta{font-size:14px}
  .preview .meta .name{font-weight:700}

  /* подигање на картиците */
  @media (min-height: 520px) {
    #startCard, #quizCard { transform: translateY(-180px); }
  }
</style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner"><img id="logoImg" src="https://cdn.worldvectorlogo.com/logos/lenovo-2.svg" alt="Lenovo" /></div>
  </div>

  <header class="hero">
    <div class="wrap hero-inner">
      <div class="intro-card" id="startCard">
        <div class="hero-img">
          <img id="heroImage" src="https://static.beebom.com/wp-content/uploads/2018/04/lenovi-thinkpad-x1.jpg?w=750&quality=75" alt="Lenovo Hero" />
        </div>
        <h1 id="heroTitle">Откриј го идеалниот Lenovo за тебе</h1>
        <p class="sub" id="heroSub">Одговори на 8 брзи прашања за 30 секунди и добиј директна препорака.</p>
        <button class="start-btn" id="startBtn" aria-label="Почни"><span id="startCta">ПОЧНИ</span>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 12h14M13 5l7 7-7 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap container">
    <div class="card hidden" id="quizCard">
      <div class="progress"><div id="bar"></div></div>
      <div id="quiz"></div>
    </div>
  </main>

  <!-- Netlify Forms (hidden) -->
  <form name="quiz-lead" method="POST" data-netlify="true" class="hidden" id="netlifyForm">
    <input type="hidden" name="form-name" value="quiz-lead" />
    <input type="hidden" name="full_name" id="nf_full_name" />
    <input type="hidden" name="email" id="nf_email" />
    <input type="hidden" name="phone" id="nf_phone" />
    <input type="hidden" name="consent" id="nf_consent" />
    <input type="hidden" name="scores_legion" id="nf_legion" />
    <input type="hidden" name="scores_thinkbook14" id="nf_thinkbook14" />
    <input type="hidden" name="scores_thinkpadE16" id="nf_thinkpadE16" />
    <input type="hidden" name="scores_v15" id="nf_v15" />
    <input type="hidden" name="primaryLane" id="nf_lane" />
    <input type="hidden" name="outcome" id="nf_outcome" />
    <input type="hidden" name="persona" id="nf_persona" />
    <input type="hidden" name="page" id="nf_page" />
    <button type="submit" id="nf_submit">submit</button>
  </form>

<script>
/* ====== ДЕФОЛТ ПАДНИ РЕШЕНИЈА (ќе се прегазат со конфиг ако постои) ====== */
const DEFAULT_CFG = {
  logo: { url: "https://cdn.worldvectorlogo.com/logos/lenovo-2.svg", data: "" },
  hero: {
    title: "Откриј го идеалниот Lenovo за тебе",
    sub: "Одговори на 8 брзи прашања за 30 секунди и добиј директна препорака.",
    cta: "ПОЧНИ",
    image: { url: "https://static.beebom.com/wp-content/uploads/2018/04/lenovi-thinkpad-x1.jpg?w=750&quality=75", data: "" }
  },
  finish: { cta: "Продолжи кон препорачан модел" },
  productUrls: {
    legion: "https://kupilenovo.mk/categories/_laptops/83F500DJRM-Legion-Legion-Pro-7-16IAX10H-Eclipse-Black---Ultra-9-275HX,-64GB,-2TB-NVMe,-RTX-5080-16GB,-16-,-DOS",
    thinkbook14: "REPLACE_WITH_THINKBOOK_14_G7_URL",
    thinkpadE16: "https://kupilenovo.mk/categories/_laptops/21SR004GRI-Lenovo-ThinkPad-E16-Gen-3-Black---Ultra-7-255H,-16GB,-1TB,-16-,-DOS",
    v15: "REPLACE_WITH_V15_G4_ABP_URL",
    fallback: "REPLACE_WITH_LOW_PRICE_CATEGORY_URL"
  },
  productImages: {
    legion: "https://kupilenovo.mk/2025/07/10/Legion_Pro_7_16IAX10H_CT1_01.jpg",
    thinkbook14: "https://via.placeholder.com/300x200?text=ThinkBook+14+G7",
    thinkpadE16: "https://kupilenovo.mk/2024/11/29/ThinkPad_E16_Gen_2_AMD_CT1_01.jpg",
    v15: "https://via.placeholder.com/300x200?text=Lenovo+V15+G4"
  },
  questions: [
    { title:"П1. За што ти е најпотребен лаптопот?", answers:[
      {text:"Гејминг", iconKey:"game", customSvg:""},
      {text:"Училиште/Факултет", iconKey:"school", customSvg:""},
      {text:"Работа", iconKey:"brief", customSvg:""}
    ], condition:null },
    { title:"П2. Што ти е најважно во моментов?", answers:[
      {text:"Максимални перформанси", iconKey:"bolt", customSvg:""},
      {text:"Удобност за цел ден", iconKey:"comfy", customSvg:""},
      {text:"Најдобра вредност за буџетот", iconKey:"value", customSvg:""}
    ], condition:null },
    { title:"П3. Каков екран ти одговара?", answers:[
      {text:"Голем и имерзивен 16″", iconKey:"display16", customSvg:""},
      {text:"Стандарден 15–16″", iconKey:"display15", customSvg:""},
      {text:"Компактен и лесен 14″", iconKey:"display14", customSvg:""}
    ], condition:null },
    { title:"П4. Твојот ден најчесто изгледа вака:", answers:[
      {text:"Долги фокус-сесии на биро", iconKey:"desk", customSvg:""},
      {text:"Се движам меѓу предавања и кафулиња", iconKey:"campus", customSvg:""},
      {text:"Низа повици, документи и табели", iconKey:"sheets", customSvg:""}
    ], condition:null },
    { title:"П5. За работа — што ти значи повеќе?", answers:[
      {text:"Премиум изработка, тастатура и моќ за тежок мултитаск", iconKey:"trophy", customSvg:""},
      {text:"Најдобра вредност што ја завршува работата", iconKey:"bulb", customSvg:""}
    ], condition:"work" },
    { title:"П6. Каде најчесто ќе го користиш?", answers:[
      {text:"Дома или гејминг-сетап", iconKey:"home", customSvg:""},
      {text:"Кампус и кафулиња", iconKey:"campus", customSvg:""},
      {text:"Канцеларија и средби со клиенти", iconKey:"office", customSvg:""}
    ], condition:null },
    { title:"П7. Избери реченица со која се поистоветуваш:", answers:[
      {text:"Сакам нешто незапирливо", iconKey:"rocket", customSvg:""},
      {text:"Сакам нешто лесно и сигурно", iconKey:"check", customSvg:""},
      {text:"Сакам нешто професионално и доверливо", iconKey:"toolbox", customSvg:""},
      {text:"Сакам паметна вредност", iconKey:"value", customSvg:""}
    ], condition:null },
    { title:"Последен чекор — остави контакт за препораката", answers:[], condition:"lead" }
  ]
};

/* Локални икони исто како во админ */
const ICONS_LOCAL = {
  game:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M6 8h12a4 4 0 0 1 4 4v3a3 3 0 1 1-6 0h-8a3 3 0 1 1-6 0v-3a4 4 0 0 1 4-4Zm2 3H6v2H4v2h2v2h2v-2h2v-2H8v-2Z"/></svg>',
  school:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 3 1 9l11 6 10-5V9L12 3Zm0 13L3.7 11 12 7l8.3 4L12 16Z"/></svg>',
  brief:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 3h6a2 2 0 0 1 2 2v2h3a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V9a2 2 0 0 1 2-2h3Zm0 4h6V5H9v2Z"/></svg>',
  bolt:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M13 2 3 14h7l-1 8 11-12h-7l0-8Z"/></svg>',
  comfy:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 12h16a2 2 0 0 1 2 2v6h-2v-2H4v2H2v-6a2 2 0 0 1 2-2Z"/></svg>',
  value:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm1 5h-2v2H8v2h3v4H9v2h3v2h2v-2h1v-2h-1v-4h3V9h-3V7Z"/></svg>',
  display16:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 5h18v10H3zM8 19h8v-2H8z"/></svg>',
  display15:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 6h16v9H4zM9 19h6v-2H9z"/></svg>',
  display14:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M5 7h14v8H5zM10 19h4v-2h-4z"/></svg>',
  desk:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M2 10h20v4h-2v6h-2v-6H6v6H4v-6H2v-4Z"/></svg>',
  campus:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M2 10 12 5l10 5-10 5-10-5Zm3 5h14v4H5v-4Z"/></svg>',
  sheets:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 3h10a2 2 0 0 1 2 2v14l-5-3-5 3V5a2 2 0  1 1 2-2Z"/></svg>',
  trophy:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 4h16v3h2a5 5 0 0 1-5 5h-2a4 4 0 0 1-8 0H5A5 5 0 0 1 3 7h1V4Zm6 12h4v2h-4v-2Z"/></svg>',
  bulb:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a7 7 0  0 1 4 13v3h-8v-3a7 7 0 0 1 4-13Zm-2 18h4v2h-4v-2Z"/></svg>',
  home:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 11 12 4l9 7v8h-6v-5H9v5H3v-8Z"/></svg>',
  office:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 3h8v18H4zM14 7h6v14h-6z"/></svg>',
  rocket:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2c4 0 7 3 7 7л-4 4-3-1-1-3 4-4C14 3 12 2 12 2ZМ5 19л2-5 3 3-5 2Z"/></svg>',
  check:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>',
  toolbox:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 7V5a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2h3a2 2 0 0 1 2 2v9H2V9a2 2 0 0 1 2-2h3Zm2 0h6V5H9v2Z"/></svg>',
  target:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10h-2a8 8 0 1 1-8-8V2Zm0 4a6 6 0 1 0 6 6h-2a4 4 0 1 1-4-4V6Z"/></svg>'
};

/* ====== ГЛОБАЛНА СОСТОЈБА ====== */
let CFG = JSON.parse(JSON.stringify(DEFAULT_CFG));
const PRODUCT_URLS = ()=>CFG.productUrls;
const PRODUCT_IMAGES = ()=>CFG.productImages;

/* ====== ВЧИТУВАЊЕ НА КОНФИГ ОД localStorage ====== */
function loadConfigFromLocalStorage(){
  try{
    const raw = localStorage.getItem('lenovoQuizConfig');
    if(!raw) return;
    const fromLS = JSON.parse(raw);

    // спој со дефаулт за да не недостигаат полиња
    CFG = deepMerge(DEFAULT_CFG, fromLS);

    // примени на UI
    const logo = (CFG.logo?.data || CFG.logo?.url || '').trim();
    if(logo) document.getElementById('logoImg').src = logo;

    document.getElementById('heroTitle').textContent = CFG.hero?.title || DEFAULT_CFG.hero.title;
    document.getElementById('heroSub').textContent = CFG.hero?.sub || DEFAULT_CFG.hero.sub;
    document.getElementById('startCta').textContent = CFG.hero?.cta || DEFAULT_CFG.hero.cta;
    const heroImg = (CFG.hero?.image?.data || CFG.hero?.image?.url || '').trim();
    if(heroImg) document.getElementById('heroImage').src = heroImg;

  }catch(e){ console.warn('Config read error', e); }
}
function deepMerge(base, patch){
  if(Array.isArray(base)){
    // за прашања земи patch ако постои; во рендер ќе читаме оттаму
    return Array.isArray(patch) ? patch : base;
  }else if(typeof base==='object' && base){
    const out = {...base};
    for(const k of Object.keys(patch||{})){
      if(typeof patch[k]==='object' && patch[k] && !Array.isArray(patch[k])){
        out[k] = deepMerge(base[k]||{}, patch[k]);
      }else{
        out[k] = patch[k];
      }
    }
    return out;
  }
  return patch===undefined ? base : patch;
}

/* ====== КВИЗ РЕНДЕР ====== */
/* Ова е истата логика како претходно: 8 прашања, Q5 по услов, скоринг, превод на икони, 2s редирект. */

const scores = { legion:0, thinkbook14:0, thinkpadE16:0, v15:0 };
let primaryLane = null;
let currentStep = 0; // ќе броиме само видливи чекори без "од N"
const quizEl = document.getElementById('quiz');
const barEl = document.getElementById('bar');
const quizCard = document.getElementById('quizCard');
const startBtn = document.getElementById('startBtn');

function startQuiz(){
  currentStep = 0;
  document.getElementById('startCard').classList.add('hidden');
  quizCard.classList.remove('hidden');
  renderStep();
}

function visibleQuestions(){
  const arr = [];
  for(const q of CFG.questions){
    if(q.condition === 'lead'){ continue; } // контакт е последен посебен чекор
    if(q.condition === 'work' && primaryLane !== 'work'){ continue; }
    arr.push(q);
  }
  return arr;
}

function renderStep(){
  const list = visibleQuestions();
  const total = list.length + 1; // +1 за контакт
  barEl.style.width = Math.min(100, Math.round((currentStep/total)*100)) + '%';

  if(currentStep < list.length){
    const q = list[currentStep];
    // чекор X
    const stepLabel = `Чекор ${currentStep+1}`;
    quizEl.innerHTML = `
      <div class="pill">${stepLabel}</div>
      <div class="q-title">${q.title}</div>
      <div class="answers">
        ${q.answers.map((a,i)=>`
          <button class="btn" data-ans="${i}">
            <span class="icon">${a.customSvg ? a.customSvg : (ICONS_LOCAL[a.iconKey]||'')}</span>
            <span>${a.text}</span>
          </button>
        `).join('')}
      </div>
    `;
    quizEl.querySelectorAll('[data-ans]').forEach(btn=>{
      btn.onclick = ()=> onAnswer(q, parseInt(btn.dataset.ans,10));
    });
  }else{
    renderContact(); // последен чекор
  }
}

function onAnswer(q, idx){
  const a = q.answers[idx]?.text || '';
  // скоринг според описот
  if(q.title.includes('П1')){
    if(a.includes('Гејминг')){ primaryLane='gaming'; scores.legion+=5; }
    if(a.includes('Училиште') || a.includes('Факултет')){ primaryLane='school'; scores.thinkbook14+=5; }
    if(a.includes('Работа')){ primaryLane='work'; scores.thinkpadE16+=3; scores.v15+=3; }
  }
  if(q.title.includes('П2')){
    if(a.includes('перформанси')){ scores.legion+=2; scores.thinkpadE16+=1; }
    if(a.includes('Удобност')){ scores.thinkbook14+=1; scores.thinkpadE16+=1; }
    if(a.includes('вредност')){ scores.v15+=2; }
  }
  if(q.title.includes('П3')){
    if(a.includes('16')){ scores.legion+=1; scores.thinkpadE16+=1; }
    if(a.includes('Стандарден')){ scores.v15+=1; scores.thinkpadE16+=1; }
    if(a.includes('14')){ scores.thinkbook14+=2; }
  }
  if(q.title.includes('П4')){
    if(a.includes('Долги')){ scores.legion+=1; scores.thinkpadE16+=1; }
    if(a.includes('предавања') || a.includes('кафулиња')){ scores.thinkbook14+=2; }
    if(a.includes('табели') || a.includes('документи')){ scores.thinkpadE16+=2; scores.v15+=1; }
  }
  if(q.title.includes('П5')){
    if(a.includes('Премиум')){ scores.thinkpadE16+=4; }
    if(a.includes('вредност')){ scores.v15+=4; }
  }
  if(q.title.includes('П6')){
    if(a.includes('гејминг')){ scores.legion+=1; }
    if(a.includes('Кампус')){ scores.thinkbook14+=1; }
    if(a.includes('Канцеларија')){ scores.thinkpadE16+=1; scores.v15+=1; }
  }
  if(q.title.includes('П7')){
    if(a.includes('незапирливо')){ scores.legion+=1; }
    if(a.includes('лесно и сигурно')){ scores.thinkbook14+=1; }
    if(a.includes('професионално')){ scores.thinkpadE16+=1; }
    if(a.includes('паметна вредност')){ scores.v15+=1; }
  }

  currentStep++;
  renderStep();
}

function renderContact(){
  barEl.style.width = '100%';
  const winner = decideWinner();
  const persona = primaryLane === "gaming" ? "gamer" : (primaryLane === "school" ? "student" : "work");

  const img = PRODUCT_IMAGES()[winner] || '';
  const nameMap = {
    legion: "Legion Pro 7 16IAX10H",
    thinkbook14: "ThinkBook 14 G7 IML",
    thinkpadE16: "ThinkPad E16 Gen 3",
    v15: "Lenovo V15 G4 ABP"
  };
  const nice = nameMap[winner] || "Lenovo";

  quizEl.innerHTML = `
    <div class="pill">Резултат</div>
    <div class="q-title">Твојот најсоодветен модел е: <strong>${nice}</strong></div>
    <div class="preview">
      ${img ? `<img src="${img}" alt="${nice}">` : ``}
      <div class="meta">
        <div class="name">${nice}</div>
        <div class="small">Пополнете контакт за да продолжите кон производот.</div>
      </div>
    </div>

    <div class="answers" style="margin-top:14px">
      <div class="row">
        <div class="field"><label>Име и презиме</label><input id="q8_name" type="text" placeholder="Име и презиме"></div>
        <div class="field"><label>Email</label><input id="q8_email" type="email" placeholder="name@example.com"></div>
      </div>
      <div class="row">
        <div class="field"><label>Телефон <span class="small">(опционално)</span></label><input id="q8_phone" type="tel" placeholder="+389..."></div>
      </div>
      <label class="consent"><input id="q8_consent" type="checkbox"> Се согласувам да бидам контактиран во врска со мојата препорака, цени и понуди.</label>
      <div class="error" id="err">Внесете валидно име и email и штиклирајте согласност.</div>
      <button class="btn primary" id="finishBtn">Продолжи кон препорачан модел</button>
    </div>
  `;

  document.getElementById('finishBtn').onclick = ()=> submitAndRedirect(winner, persona);
}

function decideWinner(){
  // lane boost
  if(primaryLane === "school"){ scores.thinkbook14 += 10; }
  if(primaryLane === "gaming"){ scores.legion += 10; }
  if(primaryLane === "work"){ scores.thinkpadE16 += 1; scores.v15 += 1; }

  // највисок скор со tie-break: Legion > ThinkPad E16 > V15 > ThinkBook14
  const order = ["legion","thinkpadE16","v15","thinkbook14"];
  let winner = order[0];
  order.forEach(k=>{ if(scores[k] > scores[winner]) winner = k; });

  // специјални правила за израмнување
  if(primaryLane === "work" && scores.thinkpadE16 === scores.v15){
    winner = "thinkpadE16";
  }
  return winner;
}

function getParam(name){ const p = new URLSearchParams(location.search); return p.get(name) || ""; }
function buildUTM(outcome, persona){
    const src = getParam("utm_source") || "meta";
    const med = getParam("utm_medium") || "paid";
    return `utm_source=${encodeURIComponent(src)}&utm_medium=${encodeURIComponent(med)}&utm_campaign=quiz&utm_content=outcome_${outcome}&utm_term=persona_${persona}`;
}

async function submitAndRedirect(winner, persona){
  const name = document.getElementById('q8_name').value.trim();
  const email = document.getElementById('q8_email').value.trim();
  const phone = document.getElementById('q8_phone').value.trim();
  const consent = document.getElementById('q8_consent').checked;

  // телефон е опционален
  const err = document.getElementById('err');
  if(!name || !email || !consent){
    err.style.display = 'block'; return;
  } else { err.style.display = 'none'; }

  // подготви Netlify form скриено
  document.getElementById('nf_full_name').value = name;
  document.getElementById('nf_email').value = email;
  document.getElementById('nf_phone').value = phone;
  document.getElementById('nf_consent').value = consent ? 'yes' : 'no';
  document.getElementById('nf_legion').value = String(scores.legion);
  document.getElementById('nf_thinkbook14').value = String(scores.thinkbook14);
  document.getElementById('nf_thinkpadE16').value = String(scores.thinkpadE16);
  document.getElementById('nf_v15').value = String(scores.v15);
  document.getElementById('nf_lane').value = primaryLane || '';
  document.getElementById('nf_outcome').value = winner;
  document.getElementById('nf_persona').value = persona;
  document.getElementById('nf_page').value = location.href;
  // испрати форма во позадина
  try{ document.getElementById('nf_submit').click(); }catch(e){}

  // прикажи потврдa и почекај 2s па редирект
  const urlBase = PRODUCT_URLS()[winner] || PRODUCT_URLS().fallback;
  const utm = buildUTM(winner, persona);
  const finalUrl = urlBase + (urlBase.includes("?") ? "&" : "?") + utm;

  const cta = document.getElementById('finishBtn');
  cta.disabled = true;
  cta.textContent = CFG.finish?.cta || "Продолжи кон препорачан модел";

  setTimeout(()=>{ window.location.href = finalUrl; }, 2000);
}

/* ====== INIT ====== */
document.addEventListener('DOMContentLoaded', ()=>{
  loadConfigFromLocalStorage();       // ← важно
  document.getElementById('startBtn').onclick = startQuiz;
});
</script>
</body>
</html>
