<!doctype html>
<html lang="mk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lenovo Квиз — Откриј го идеалниот Lenovo</title>
<meta name="description" content="Одговори на 8 брзи прашања и добиј директна препорака за идеален Lenovo лаптоп." />
<style>
  :root{
    --bg:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb; --card:#ffffff;
    --lenovo-red:#E2231A; --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.06);
  }
  *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* header logo centered (UNCHANGED) */
  .topbar { position:sticky; top:0; z-index:50; background:#fff; border-bottom:1px solid var(--border);
            width:100%; display:flex; justify-content:center; align-items:center; padding:12px 0; }
  .topbar-inner { width:100%; display:flex; justify-content:center; align-items:center; }
  .topbar-inner img { display:block; margin:0 auto; height:58px; }

  .wrap{max-width:960px;margin:0 auto;padding:20px}

  header.hero{background:#fff;}
  .hero-inner{
    display:flex; align-items:center; justify-content:center;
    min-height:38vh; padding:10px;
  }
  .intro-card{
    background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
    box-shadow:var(--shadow); width:min(820px,100%); padding:22px;
    text-align:center; margin:0 auto;  margin-top:400px !important; /* НЕ МЕНУВАМ */
  }
  @media (max-width: 720px) {
    .intro-card { margin-top: 260px !important; } /* НЕ МЕНУВАМ */
  }
  h1{font-size:24px;margin:8px 0 6px}
  .sub{color:var(--muted);margin:0 0 18px;font-size:14px}
  .start-btn{display:inline-flex;align-items:center;gap:10px;background:var(--lenovo-red);color:#fff;border:none;padding:12px 18px;border-radius:999px;cursor:pointer;font-weight:700;letter-spacing:.2px;text-transform:uppercase}

  .container{padding:18px 0 36px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow);max-width:780px;margin:0 auto}
  .progress{height:8px;border-radius:8px;background:#f3f4f6;overflow:hidden;margin:4px 0 16px}
  .progress>div{height:100%;background:var(--lenovo-red);width:0%}
  .pill{display:inline-block;background:#f8fafc;border:1px solid var(--border);color:#6b7280;border-radius:999px;padding:6px 10px;font-size:12px;margin-bottom:8px}
  .q-title{font-size:20px;margin:6px 0 14px}
  .answers{display:grid;gap:12px}
  .btn{border:1px solid var(--border);background:#fff;color:var(--text);padding:14px 14px;border-radius:12px;font-weight:600;cursor:pointer;text-align:left;display:flex;align-items:center;gap:12px;transition:transform .03s ease, border-color .15s ease, box-shadow .15s ease, background .15s ease}
  .btn:hover{border-color:#c9ced6;box-shadow:0 4px 14px rgba(17,24,39,.06)}
  .btn.primary{display:inline-flex;align-items:center;justify-content:center;text-align:center;background:var(--lenovo-red);color:#fff;border:0}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .field{flex:1 1 220px;display:flex;flex-direction:column;gap:6px}
  input[type="text"],input[type="email"],input[type="tel"]{background:#fff;border:1px solid var(--border);color:#111827;border-radius:10px;padding:12px 12px;font-size:15px}
  label.consent{display:flex;align-items:flex-start;gap:10px;color:#374151;font-size:14px;margin:8px 0 10px}
  input[type="checkbox"]{transform:translateY(2px)}
  .error{color:#dc2626;font-size:13px;margin-top:4px;display:none}
  .hidden{display:none !important}
  .grid-2{grid-template-columns:1fr}
  @media(min-width:720px){ .grid-2{grid-template-columns:repeat(2,1fr)} }

  /* hero image center (UNCHANGED) */
  .hero-img{
    width:100%; max-width:780px; margin:0 auto 14px auto;
    border-radius:14px; overflow:hidden; border:1px solid var(--border);
    display:flex; align-items:center; justify-content:center;
  }
  .hero-img img{ display:block; max-width:100%; height:auto; margin:0 auto; }

  .preview{margin-top:12px; display:flex; gap:12px; align-items:center; border:1px solid var(--border); padding:12px; border-radius:12px; background:#fafafa}
  .preview img{width:88px;height:88px;object-fit:cover;border-radius:10px;border:1px solid #e5e7eb;background:#fff}
  .preview .meta{font-size:14px}
  .preview .meta .name{font-weight:700}

  /* подигање на картиците — НЕ МЕНУВАМ */
  @media (min-height: 520px) {
    #startCard, #quizCard { transform: translateY(-180px); }
  }
</style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner"><img id="logoImg" src="https://cdn.worldvectorlogo.com/logos/lenovo-2.svg" alt="Lenovo" /></div>
  </div>

  <header class="hero">
    <div class="wrap hero-inner">
      <div class="intro-card" id="startCard">
        <div class="hero-img">
          <img id="heroImage" src="https://static.beebom.com/wp-content/uploads/2018/04/lenovi-thinkpad-x1.jpg?w=750&quality=75" alt="Lenovo Hero" />
        </div>
        <h1 id="heroTitle">Откриј го идеалниот Lenovo за тебе</h1>
        <p class="sub" id="heroSub">Одговори на неколку брзи прашања за 30 секунди и дознај кој Lenovo е совршен за твоите потреби</p>
        <button class="start-btn" id="startBtn" aria-label="Почни"><span id="startCta">ПОЧНИ</span>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M5 12h14M13 5l7 7-7 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap container">
    <div class="card hidden" id="quizCard">
      <div class="progress"><div id="bar"></div></div>
      <div id="quiz"></div>
    </div>
  </main>

  <!-- Netlify Forms (hidden) -->
  <form name="quiz-lead" method="POST" data-netlify="true" class="hidden" id="netlifyForm">
    <input type="hidden" name="form-name" value="quiz-lead" />
    <input type="hidden" name="full_name" id="nf_full_name" />
    <input type="hidden" name="email" id="nf_email" />
    <input type="hidden" name="phone" id="nf_phone" />
    <input type="hidden" name="consent" id="nf_consent" />
    <input type="hidden" name="scores_legion" id="nf_legion" />
    <input type="hidden" name="scores_thinkbook14" id="nf_thinkbook14" />
    <input type="hidden" name="scores_thinkpadE16" id="nf_thinkpadE16" />
    <input type="hidden" name="scores_v15" id="nf_v15" />
    <input type="hidden" name="primaryLane" id="nf_lane" />
    <input type="hidden" name="outcome" id="nf_outcome" />
    <input type="hidden" name="persona" id="nf_persona" />
    <input type="hidden" name="page" id="nf_page" />
    <button type="submit" id="nf_submit">submit</button>
  </form>

<script>
/* ====== DEFAULT CONFIG (all MK) ====== */
const DEFAULT_CFG = {
  logo: { url: "https://cdn.worldvectorlogo.com/logos/lenovo-2.svg", data: "" },
  hero: {
    title: "Откриј го идеалниот Lenovo за тебе",
    sub: "Одговори на неколку брзи прашања за 30 секунди и дознај кој Lenovo е совршен за твоите потреби",
    cta: "ПОЧНИ",
    image: { url: "https://static.beebom.com/wp-content/uploads/2018/04/lenovi-thinkpad-x1.jpg?w=750&quality=75", data: "" }
  },
  finish: { cta: "Продолжи кон препорачан модел" },
  productUrls: {
    legion: "https://kupilenovo.mk/categories/_laptops/83F500DJRM-Legion-Legion-Pro-7-16IAX10H-Eclipse-Black---Ultra-9-275HX,-64GB,-2TB-NVMe,-RTX-5080-16GB,-16-,-DOS",
    thinkbook14: "https://kupilenovo.mk/categories/_laptops/21MR004HRM-Lenovo-ThinkBook-14-G7-IML-Arctic-Grey----Ultra-7-155H,-32GB,-512GB-SSD,-14-,-DOS",
    thinkpadE16: "https://kupilenovo.mk/categories/_laptops/21SR004GRI-Lenovo-ThinkPad-E16-Gen-3-Black---Ultra-7-255H,-16GB,-1TB,-16-,-DOS",
    v15: "https://kupilenovo.mk/categories/_laptops/21MS004TRM--Lenovo-ThinkBook-16-G7-IML-Arctic-Grey---Ultra-5-125U,-16GB,-1TB-NVMe,-16-,-DOS",
    fallback: "https://kupilenovo.mk/_laptops.nspx?priceRange=9750_31137"
  },
  productImages: {
    legion: "https://kupilenovo.mk/2025/07/10/Legion_Pro_7_16IAX10H_CT1_01.jpg",
    thinkbook14: "https://via.placeholder.com/300x200?text=ThinkBook+14+G7",
    thinkpadE16: "https://kupilenovo.mk/2024/11/29/ThinkPad_E16_Gen_2_AMD_CT1_01.jpg",
    v15: "https://via.placeholder.com/300x200?text=ThinkBook+16+G7"
  },
  questions: [
    { id:"q1", title:"П1. За што ти треба лаптопот?", answers:[
      {text:"Видео игри"},
      {text:"Факултет/училиште"},
      {text:"Работа"}
    ], condition:null },
    { id:"q2", title:"П2. Што ти е најважно сега?", answers:[
      {text:"Да е брз и моќен"},
      {text:"Да ми е комотен за работа цел ден"},
      {text:"Најдобра вредност за мојот буџет"}
    ], condition:null },
    { id:"q3", title:"П3. Каков екран ти одговара?", answers:[
      {text:"Голем (16 inch)"},
      {text:"Стандарден (15 inch)"},
      {text:"Компактен и лесен (14 inch)"}
    ], condition:null },
    { id:"q4", title:"П4. Твојот ден најчесто изгледа вака:", answers:[
      {text:"Долги фокус сесии на биро"},
      {text:"Се движам меѓу предавања и кафулиња"},
      {text:"Едно по друго повици, документи и табели"}
    ], condition:null },
    { id:"q5", title:"П5. Само за работа: што повеќе ти одговара?", answers:[
      {text:"Премиум изработка, тастатура и моќ за тежок мултитаскинг"},
      {text:"Најдобра вредност што ја завршува работата"}
    ], condition:"work" },
    { id:"q6", title:"П6. Каде најчесто ќе го користиш?", answers:[
      {text:"Дома или гејминг-сетап"},
      {text:"На факултет или во училница"},
      {text:"Во канцеларија или на состаноци со клиенти"}
    ], condition:null },
    { id:"q7", title:"П7. Што ти звучи најблиску до тебе?", answers:[
      {text:"Сакам нешто незапирливо"},
      {text:"Сакам нешто лесно и сигурно"},
      {text:"Сакам нешто професионално и стабилно"},
      {text:"Сакам нешто со паметна вредност"}
    ], condition:null },
    { id:"lead", title:"Остави контакт за да ја добиеш препораката и линк до производот.", answers:[], condition:"lead" }
  ]
};

/* ====== STATE & INIT CFG LOAD ====== */
let CFG = JSON.parse(JSON.stringify(DEFAULT_CFG));
const PRODUCT_URLS = ()=>CFG.productUrls;
const PRODUCT_IMAGES = ()=>CFG.productImages;

function loadConfigFromLocalStorage(){
  try{
    const raw = localStorage.getItem('lenovoQuizConfig');
    if(!raw) return;
    const fromLS = JSON.parse(raw);
    CFG = deepMerge(DEFAULT_CFG, fromLS);

    const logo = (CFG.logo?.data || CFG.logo?.url || '').trim();
    if(logo) document.getElementById('logoImg').src = logo;

    document.getElementById('heroTitle').textContent = CFG.hero?.title || DEFAULT_CFG.hero.title;
    document.getElementById('heroSub').textContent = CFG.hero?.sub || DEFAULT_CFG.hero.sub;
    document.getElementById('startCta').textContent = CFG.hero?.cta || DEFAULT_CFG.hero.cta;
    const heroImg = (CFG.hero?.image?.data || CFG.hero?.image?.url || '').trim();
    if(heroImg) document.getElementById('heroImage').src = heroImg;

  }catch(e){ console.warn('Config read error', e); }
}
function deepMerge(base, patch){
  if(Array.isArray(base)){
    return Array.isArray(patch) ? patch : base;
  }else if(typeof base==='object' && base){
    const out = {...base};
    for(const k of Object.keys(patch||{})){
      if(typeof patch[k]==='object' && patch[k] && !Array.isArray(patch[k])){
        out[k] = deepMerge(base[k]||{}, patch[k]);
      }else{
        out[k] = patch[k];
      }
    }
    return out;
  }
  return patch===undefined ? base : patch;
}

/* ====== QUIZ RENDER ====== */
const scores = { legion:0, thinkbook14:0, thinkpadE16:0, v15:0 }; // v15 key = ThinkBook 16 G7 (best value work)
let primaryLane = null;
let currentStep = 0;
const quizEl = document.getElementById('quiz');
const barEl = document.getElementById('bar');
const quizCard = document.getElementById('quizCard');

function startQuiz(){
  currentStep = 0;
  document.getElementById('startCard').classList.add('hidden');
  quizCard.classList.remove('hidden');
  renderStep();
}

function visibleQuestions(){
  const arr = [];
  for(const q of CFG.questions){
    if(q.condition === 'lead'){ continue; }
    if(q.condition === 'work' && primaryLane !== 'work'){ continue; }
    arr.push(q);
  }
  return arr;
}

function renderStep(){
  const list = visibleQuestions();
  const total = list.length + 1; // + contact step
  barEl.style.width = Math.min(100, Math.round((currentStep/total)*100)) + '%';

  if(currentStep < list.length){
    const q = list[currentStep];
    const stepLabel = `Чекор ${currentStep+1}`;
    const answersHtml = q.answers.map((a,i)=> `
      <button class="btn" data-ans="${i}">
        <span>${a.text}</span>
      </button>
    `).join('');
    quizEl.innerHTML = `
      <div class="pill">${stepLabel}</div>
      <div class="q-title">${q.title}</div>
      <div class="answers">
        ${answersHtml}
      </div>
    `;
    quizEl.querySelectorAll('[data-ans]').forEach(btn=>{
      btn.onclick = ()=> onAnswer(q, parseInt(btn.dataset.ans,10));
    });
  }else{
    renderContact();
  }
}

function onAnswer(q, idx){
  const a = q.answers[idx]?.text || '';

  switch(q.id){
    case 'q1':
      if(a.includes('Видео игри')){ primaryLane='gaming'; scores.legion+=5; }
      if(a.includes('Факултет') || a.includes('училиште')){ primaryLane='school'; scores.thinkbook14+=5; }
      if(a.includes('Работа')){ primaryLane='work'; scores.thinkpadE16+=3; scores.v15+=3; }
      break;
    case 'q2':
      if(a.includes('брз') || a.includes('моќен')){ scores.legion+=2; scores.thinkpadE16+=1; }
      if(a.includes('комотен')){ scores.thinkbook14+=1; scores.thinkpadE16+=1; }
      if(a.includes('вредност')){ scores.v15+=2; }
      break;
    case 'q3':
      if(a.includes('16')){ scores.legion+=1; scores.thinkpadE16+=1; }
      if(a.includes('Стандарден') || a.includes('15')){ scores.v15+=1; scores.thinkpadE16+=1; }
      if(a.includes('14')){ scores.thinkbook14+=2; }
      break;
    case 'q4':
      if(a.includes('Долги фокус')){ scores.legion+=1; scores.thinkpadE16+=1; }
      if(a.includes('предавања') || a.includes('кафулиња')){ scores.thinkbook14+=2; }
      if(a.includes('табели') || a.includes('повици') || a.includes('документи')){ scores.thinkpadE16+=2; scores.v15+=1; }
      break;
    case 'q5':
      if(a.includes('Премиум')){ scores.thinkpadE16+=4; }
      if(a.includes('вредност')){ scores.v15+=4; }
      break;
    case 'q6':
      if(a.includes('гејминг')){ scores.legion+=1; }
      if(a.includes('факултет') || a.includes('училница')){ scores.thinkbook14+=1; }
      if(a.includes('канцеларија') || a.includes('состаноци')){ scores.thinkpadE16+=1; scores.v15+=1; }
      break;
    case 'q7':
      if(a.includes('незапирливо')){ scores.legion+=1; }
      if(a.includes('лесно и сигурно')){ scores.thinkbook14+=1; }
      if(a.includes('професионално') || a.includes('стабилно')){ scores.thinkpadE16+=1; }
      if(a.includes('паметна вредност')){ scores.v15+=1; }
      break;
  }

  renderStep(++currentStep);
}

function renderContact(){
  barEl.style.width = '100%';
  const winner = decideWinner();
  const persona = primaryLane === "gaming" ? "gamer" : (primaryLane === "school" ? "student" : "work");

  const img = PRODUCT_IMAGES()[winner] || '';
  const nameMap = {
    legion: "Legion Pro 7 16IAX10H",
    thinkbook14: "ThinkBook 14 G7 IML",
    thinkpadE16: "ThinkPad E16 Gen 3",
    v15: "ThinkBook 16 G7 IML Arctic Grey"
  };
  const nice = nameMap[winner] || "Lenovo";

  quizEl.innerHTML = `
    <div class="pill">Резултат</div>
    <div class="q-title">Твојот најсоодветен модел е: <strong>${nice}</strong></div>
    <div class="preview">
      ${img ? `<img src="${img}" alt="${nice}">` : ``}
      <div class="meta">
        <div class="name">${nice}</div>
        <div class="small">Пополнете контакт за да продолжите кон производот.</div>
      </div>
    </div>

    <div class="answers" style="margin-top:14px">
      <div class="row">
        <div class="field"><label>Име и презиме</label><input id="q8_name" type="text" placeholder="Име и презиме"></div>
        <div class="field"><label>Email</label><input id="q8_email" type="email" placeholder="name@example.com"></div>
      </div>
      <div class="row">
        <div class="field"><label>Телефон <span class="small">(опционално)</span></label><input id="q8_phone" type="tel" placeholder="+389..."></div>
      </div>
      <label class="consent"><input id="q8_consent" type="checkbox"> Се согласувам да бидам контактиран во врска со мојата препорака, цени и понуди.</label>
      <div class="error" id="err">Внесете валидно име, валиден email и штиклирајте согласност.</div>
      <button class="btn primary" id="finishBtn">Продолжи кон препорачан модел</button>
    </div>
  `;

  document.getElementById('finishBtn').onclick = ()=> submitAndRedirect(winner, persona);
}

function decideWinner(){
  if(primaryLane === "school"){ scores.thinkbook14 += 10; }
  if(primaryLane === "gaming"){ scores.legion += 10; }
  if(primaryLane === "work"){ scores.thinkpadE16 += 1; scores.v15 += 1; }

  const order = ["legion","thinkpadE16","v15","thinkbook14"];
  let winner = order[0];
  order.forEach(k=>{ if(scores[k] > scores[winner]) winner = k; });

  if(primaryLane === "work" && scores.thinkpadE16 === scores.v15){
    winner = "thinkpadE16";
  }
  return winner;
}

function getParam(name){ const p = new URLSearchParams(location.search); return p.get(name) || ""; }
function buildUTM(outcome, persona){
  const src = getParam("utm_source") || "meta";
  const med = getParam("utm_medium") || "paid";
  return `utm_source=${encodeURIComponent(src)}&utm_medium=${encodeURIComponent(med)}&utm_campaign=quiz&utm_content=outcome_${outcome}&utm_term=persona_${persona}`;
}

/* ---- Sheets sender (Apps Script) ---- */
function sendToSheetsJSON(webAppUrl, payloadObj){
  try {
    const blob = new Blob([JSON.stringify(payloadObj)], { type: 'text/plain;charset=UTF-8' });
    navigator.sendBeacon(webAppUrl, blob);
  } catch(e){
    fetch(webAppUrl, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'text/plain;charset=UTF-8' },
      body: JSON.stringify(payloadObj)
    }).catch(()=>{});
  }
}

async function submitAndRedirect(winner, persona){
  const name = document.getElementById('q8_name').value.trim();
  const email = document.getElementById('q8_email').value.trim();
  const phone = document.getElementById('q8_phone').value.trim();
  const consent = document.getElementById('q8_consent').checked;

  const err = document.getElementById('err');
  const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(email);
  if(!name || !emailOk || !consent){
    err.style.display = 'block'; return;
  } else { err.style.display = 'none'; }

  // (optional) Netlify hidden form
  document.getElementById('nf_full_name').value = name;
  document.getElementById('nf_email').value = email;
  document.getElementById('nf_phone').value = phone;
  document.getElementById('nf_consent').value = consent ? 'yes' : 'no';
  document.getElementById('nf_legion').value = String(scores.legion);
  document.getElementById('nf_thinkbook14').value = String(scores.thinkbook14);
  document.getElementById('nf_thinkpadE16').value = String(scores.thinkpadE16);
  document.getElementById('nf_v15').value = String(scores.v15);
  document.getElementById('nf_lane').value = primaryLane || '';
  document.getElementById('nf_outcome').value = winner;
  document.getElementById('nf_persona').value = persona;
  document.getElementById('nf_page').value = location.href;

  // Send to Google Sheets
  const payload = {
    timestamp: new Date().toISOString(),
    full_name: name, email, phone, consent: consent ? 'yes' : 'no',
    lane: (primaryLane || ''), outcome: winner, persona,
    scores_legion: String(scores.legion),
    scores_thinkbook14: String(scores.thinkbook14),
    scores_thinkpadE16: String(scores.thinkpadE16),
    scores_v15: String(scores.v15),
    utm_source: (new URLSearchParams(location.search).get("utm_source") || "meta"),
    utm_medium: (new URLSearchParams(location.search).get("utm_medium") || "paid"),
    utm_campaign: "quiz",
    utm_content: `outcome_${winner}`,
    utm_term: `persona_${persona}`,
    page: location.href,
    userAgent: navigator.userAgent,
    referrer: document.referrer || ""
  };
  sendToSheetsJSON(
    "https://script.google.com/macros/s/AKfycbx4NG7bgInqluGB2XoymZzVIoyuLs0s8FEfWBpQv0UNHXT7agrums20jfQGk_jdPo9Q/exec",
    payload
  );

  // Immediate redirect
  const urlBase = PRODUCT_URLS()[winner] || PRODUCT_URLS().fallback;
  const utm = buildUTM(winner, persona);
  const finalUrl = urlBase + (urlBase.includes("?") ? "&" : "?") + utm;

  const cta = document.getElementById('finishBtn');
  cta.disabled = true;
  cta.textContent = (CFG.finish?.cta || "Продолжи кон препорачан модел");

  window.location.href = finalUrl;
}

/* INIT */
document.addEventListener('DOMContentLoaded', ()=>{
  loadConfigFromLocalStorage();
  document.getElementById('startBtn').onclick = startQuiz;
});
</script>
</body>
</html>
