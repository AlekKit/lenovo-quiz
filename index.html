async function submitAndRedirect(winner, persona){
  const name = document.getElementById('q8_name').value.trim();
  const email = document.getElementById('q8_email').value.trim();
  const phone = document.getElementById('q8_phone').value.trim();
  const consent = document.getElementById('q8_consent').checked;

  const err = document.getElementById('err');
  const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(email);
  if(!name || !emailOk || !consent){
    err.style.display = 'block';
    return;
  } else {
    err.style.display = 'none';
  }

  // (optional) Netlify hidden form
  document.getElementById('nf_full_name').value = name;
  document.getElementById('nf_email').value = email;
  document.getElementById('nf_phone').value = phone;
  document.getElementById('nf_consent').value = consent ? 'yes' : 'no';
  document.getElementById('nf_legion').value = String(scores.legion);
  document.getElementById('nf_thinkbook14').value = String(scores.thinkbook14);
  document.getElementById('nf_thinkpadE16').value = String(scores.thinkpadE16);
  document.getElementById('nf_v15').value = String(scores.v15);
  document.getElementById('nf_lane').value = primaryLane || '';
  document.getElementById('nf_outcome').value = winner;
  document.getElementById('nf_persona').value = persona;
  document.getElementById('nf_page').value = location.href;

  // Send to Google Sheets
  const payload = {
    timestamp: new Date().toISOString(),
    full_name: name, email, phone, consent: consent ? 'yes' : 'no',
    lane: (primaryLane || ''), outcome: winner, persona,
    scores_legion: String(scores.legion),
    scores_thinkbook14: String(scores.thinkbook14),
    scores_thinkpadE16: String(scores.thinkpadE16),
    scores_v15: String(scores.v15),
    utm_source: (new URLSearchParams(location.search).get("utm_source") || "meta"),
    utm_medium: (new URLSearchParams(location.search).get("utm_medium") || "paid"),
    utm_campaign: "quiz",
    utm_content: `outcome_${winner}`,
    utm_term: `persona_${persona}`,
    page: location.href,
    userAgent: navigator.userAgent,
    referrer: document.referrer || ""
  };
  sendToSheetsJSON(
    "https://script.google.com/macros/s/AKfycbx4NG7bgInqluGB2XoymZzVIoyuLs0s8FEfWBpQv0UNHXT7agrums20jfQGk_jdPo9Q/exec",
    payload
  );

  // FIRE META LEAD EVENT HERE
  if (typeof fbq === 'function') {
    fbq('track', 'Lead', {
      quiz_name: 'lenovo_quiz',
      outcome: winner,
      persona: persona
    });
  }

  // Prepare redirect URL
  const urlBase = PRODUCT_URLS()[winner] || PRODUCT_URLS().fallback;
  const utm = buildUTM(winner, persona);
  const finalUrl = urlBase + (urlBase.includes("?") ? "&" : "?") + utm;

  const cta = document.getElementById('finishBtn');
  cta.disabled = true;
  cta.textContent = (CFG.finish?.cta || "Продолжи кон препорачан модел");

  // DELAY REDIRECT SO META CAN SEND EVENT
  setTimeout(function() {
    window.location.href = finalUrl;
  }, 400);
}
