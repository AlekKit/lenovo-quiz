<!doctype html>
<html lang="mk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lenovo Квиз — Админ</title>
<style>
  :root{ --red:#E2231A; --border:#e5e7eb; --muted:#6b7280; --text:#111827; --bg:#fff; }
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:var(--bg)}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);padding:12px 16px;z-index:20}
  header .row{display:flex;gap:12px;align-items:center;justify-content:space-between;max-width:1100px;margin:0 auto}
  h1{font-size:18px;margin:0}
  main{max-width:1100px;margin:0 auto;padding:16px;display:grid;gap:16px}
  .card{border:1px solid var(--border);border-radius:12px;padding:16px}
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:1fr}
  .grid-3{grid-template-columns:1fr}
  @media(min-width:960px){ .grid-2{grid-template-columns:1fr 1fr} .grid-3{grid-template-columns:repeat(3,1fr)} }
  label{font-weight:600;font-size:14px}
  input, textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:8px}
  textarea{min-height:80px;resize:vertical}
  .btn{background:#fff;border:1px solid var(--border);padding:10px 14px;border-radius:999px;cursor:pointer}
  .btn.primary{background:var(--red);color:#fff;border:0}
  .row-btns{display:flex;gap:8px;flex-wrap:wrap}
  .small{font-size:12px;color:var(--muted)}
  .q-block{border:1px dashed var(--border);border-radius:10px;padding:12px;margin:10px 0}
  .ans-row{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
  .pill{display:inline-block;background:#f8fafc;border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:12px;margin-bottom:8px}
  .inline-split{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .preview{display:flex;gap:10px;align-items:center;margin-top:8px}
  .preview img{width:56px;height:56px;border:1px solid var(--border);border-radius:8px;object-fit:cover}
  .tabs{display:flex;gap:6px;margin:6px 0 10px}
  .tab{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
  .tab.active{background:#111827;color:#fff;border-color:#111827}
  .icon-picker{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;border:1px solid var(--border);padding:8px;border-radius:10px;max-height:260px;overflow:auto}
  .icon-btn{border:1px solid var(--border);padding:8px;border-radius:10px;background:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center}
  .icon-btn svg{width:22px;height:22px}
  .icon-active{outline:2px solid var(--red)}
</style>
</head>
<body>
  <header>
    <div class="row">
      <h1>Lenovo Квиз — Админ</h1>
      <div class="row-btns">
        <button id="btnLoad" class="btn">Вчитај</button>
        <button id="btnSave" class="btn primary">Зачувај</button>
        <button id="btnExport" class="btn">Export JSON</button>
        <label class="btn">Import JSON <input id="fileImport" type="file" accept="application/json" style="display:none"></label>
      </div>
    </div>
  </header>

  <main>
    <div class="card">
      <div class="pill">Лого (header)</div>
      <div class="grid grid-2">
        <div>
          <label>Лого (URL)</label>
          <input id="cfg_logo_url" placeholder="https://..." />
          <div class="small">Ако пополнето, има предност над upload-от.</div>
        </div>
        <div>
          <label>Лого (Upload → base64)</label>
          <input id="cfg_logo_file" type="file" accept="image/*" />
          <div class="preview"><img id="preview_logo" alt=""><span class="small">Преглед</span></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="pill">Hero / Start</div>
      <div class="grid grid-3">
        <div><label>Наслов</label><input id="cfg_hero_title" placeholder="Откриј го идеалниот Lenovo за тебе" /></div>
        <div><label>Поднаслов</label><input id="cfg_hero_sub" placeholder="Одговори на 8 брзи прашања..." /></div>
        <div><label>CTA (Start копче)</label><input id="cfg_start_cta" placeholder="ПОЧНИ" /></div>
      </div>
      <div class="grid grid-2" style="margin-top:8px">
        <div><label>Hero слика (URL)</label><input id="cfg_hero_img_url" placeholder="https://..." /></div>
        <div><label>Hero слика (Upload → base64)</label><input id="cfg_hero_img_file" type="file" accept="image/*" />
          <div class="preview"><img id="preview_hero" alt=""><span class="small">Преглед</span></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="pill">Завршница</div>
      <div class="grid grid-2">
        <div><label>CTA (финиш копче)</label><input id="cfg_finish_cta" placeholder="Продолжи кон препорачан модел" /></div>
      </div>
    </div>

    <div class="card">
      <div class="pill">Производи</div>
      <div class="grid grid-2">
        <div>
          <label>Legion URL</label><input id="u_legion" />
          <label style="margin-top:8px">Legion слика (URL/base64)</label><input id="i_legion" />
        </div>
        <div>
          <label>ThinkBook 14 G7 URL</label><input id="u_thinkbook14" />
          <label style="margin-top:8px">ThinkBook 14 G7 слика</label><input id="i_thinkbook14" />
        </div>
        <div>
          <label>ThinkPad E16 URL</label><input id="u_thinkpadE16" />
          <label style="margin-top:8px">ThinkPad E16 слика</label><input id="i_thinkpadE16" />
        </div>
        <div>
          <label>V15 G4 URL</label><input id="u_v15" />
          <label style="margin-top:8px">V15 G4 слика</label><input id="i_v15" />
        </div>
        <div>
          <label>Fallback (категорија ниска цена)</label><input id="u_fallback" />
        </div>
      </div>
    </div>

    <div class="card" id="questionsCard">
      <div class="pill">Прашања + Икони</div>

      <div class="tabs">
        <button id="tabLocal" class="tab active">Локални икони</button>
        <button id="tabExternal" class="tab">External Icons (Tabler)</button>
      </div>

      <div id="localIconsPane">
        <div id="qWrap"></div>
        <div class="small" style="margin-top:6px">Совет: кликни во полето „икона key“, па избери од листата подолу, или залепи Custom SVG.</div>
        <div style="margin-top:8px">
          <label>Пребарај локални икони</label>
          <input id="iconSearchLocal" placeholder="game, school, brief..." />
          <div id="iconLibraryLocal" class="icon-picker" style="margin-top:8px"></div>
        </div>
      </div>

      <div id="externalIconsPane" class="hidden">
        <div class="grid grid-2">
          <div>
            <label>Пребарај Tabler icons (пр. laptop, user, chart)</label>
            <input id="iconSearchExt" placeholder="laptop, school, briefcase..." />
            <div class="small">Извор: Iconify API (колекција „tabler“). Кешира 24h локално.</div>
          </div>
          <div style="display:flex;align-items:flex-end"><button id="btnFetchExt" class="btn">Пребарај</button></div>
        </div>
        <div id="iconLibraryExt" class="icon-picker" style="margin-top:8px"></div>
      </div>

      <div class="row-btns" style="margin-top:12px">
        <button id="addQ" class="btn">Додај прашање</button>
      </div>
    </div>

    <div class="card">
      <div class="row-btns">
        <button id="btnSave2" class="btn primary">Зачувај</button>
        <button id="btnReset" class="btn">Reset (брише локални)</button>
      </div>
      <div class="small" style="margin-top:8px">
        Се зачувува како <strong>lenovoQuizConfig</strong> во localStorage. Homepage (`index.html`) автоматски го вчитува ако постои.
      </div>
    </div>
  </main>

<script>
/* ===== Default Config (исто како претходно) ===== */
const DEFAULT = {
  logo: { url: "https://cdn.worldvectorlogo.com/logos/lenovo-2.svg", data: "" },
  hero: {
    title: "Откриј го идеалниот Lenovo за тебе",
    sub: "Одговори на 8 брзи прашања за 30 секунди и добиј директна препорака.",
    cta: "ПОЧНИ",
    image: { url: "https://static.beebom.com/wp-content/uploads/2018/04/lenovi-thinkpad-x1.jpg?w=750&quality=75", data: "" }
  },
  finish: { cta: "Продолжи кон препорачан модел" },
  productUrls: {
    legion: "https://kupilenovo.mk/categories/_laptops/83F500DJRM-Legion-Legion-Pro-7-16IAX10H-Eclipse-Black---Ultra-9-275HX,-64GB,-2TB-NVMe,-RTX-5080-16GB,-16-,-DOS",
    thinkbook14: "REPLACE_WITH_THINKBOOK_14_G7_URL",
    thinkpadE16: "https://kupilenovo.mk/categories/_laptops/21SR004GRI-Lenovo-ThinkPad-E16-Gen-3-Black---Ultra-7-255H,-16GB,-1TB,-16-,-DOS",
    v15: "REPLACE_WITH_V15_G4_ABP_URL",
    fallback: "REPLACE_WITH_LOW_PRICE_CATEGORY_URL"
  },
  productImages: {
    legion: "https://kupilenovo.mk/2025/07/10/Legion_Pro_7_16IAX10H_CT1_01.jpg",
    thinkbook14: "https://via.placeholder.com/300x200?text=ThinkBook+14+G7",
    thinkpadE16: "https://kupilenovo.mk/2024/11/29/ThinkPad_E16_Gen_2_AMD_CT1_01.jpg",
    v15: "https://via.placeholder.com/300x200?text=Lenovo+V15+G4"
  },
  questions: [
    { title:"П1. За што ти е најпотребен лаптопот?", answers:[
      {text:"Гејминг", icon:"game", customSvg:""},
      {text:"Училиште/Факултет", icon:"school", customSvg:""},
      {text:"Работа", icon:"brief", customSvg:""}
    ], condition:null },
    { title:"П2. Што ти е најважно во моментов?", answers:[
      {text:"Максимални перформанси", icon:"bolt", customSvg:""},
      {text:"Удобност за цел ден", icon:"comfy", customSvg:""},
      {text:"Најдобра вредност за буџетот", icon:"value", customSvg:""}
    ], condition:null },
    { title:"П3. Каков екран ти одговара?", answers:[
      {text:"Голем и имерзивен 16″", icon:"display16", customSvg:""},
      {text:"Стандарден 15–16″", icon:"display15", customSvg:""},
      {text:"Компактен и лесен 14″", icon:"display14", customSvg:""}
    ], condition:null },
    { title:"П4. Твојот ден најчесто изгледа вака:", answers:[
      {text:"Долги фокус-сесии на биро", icon:"desk", customSvg:""},
      {text:"Се движам меѓу предавања и кафулиња", icon:"campus", customSvg:""},
      {text:"Низа повици, документи и табели", icon:"sheets", customSvg:""}
    ], condition:null },
    { title:"П5. За работа — што ти значи повеќе?", answers:[
      {text:"Премиум изработка, тастатура и моќ за тежок мултитаск", icon:"trophy", customSvg:""},
      {text:"Најдобра вредност што ја завршува работата", icon:"bulb", customSvg:""}
    ], condition:"work" },
    { title:"П6. Каде најчесто ќе го користиш?", answers:[
      {text:"Дома или гејминг-сетап", icon:"home", customSvg:""},
      {text:"Кампус и кафулиња", icon:"campus", customSvg:""},
      {text:"Канцеларија и средби со клиенти", icon:"office", customSvg:""}
    ], condition:null },
    { title:"П7. Избери реченица со која се поистоветуваш:", answers:[
      {text:"Сакам нешто незапирливо", icon:"rocket", customSvg:""},
      {text:"Сакам нешто лесно и сигурно", icon:"check", customSvg:""},
      {text:"Сакам нешто професионално и доверливо", icon:"toolbox", customSvg:""},
      {text:"Сакам паметна вредност", icon:"value", customSvg:""}
    ], condition:null },
    { title:"Последен чекор — остави контакт за препораката", answers:[], condition:"lead" }
  ]
};

/* ===== Локална мини-икон библиотека (како претходно) ===== */
const ICONS_LOCAL = {
  game:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M6 8h12a4 4 0 0 1 4 4v3a3 3 0 1 1-6 0h-8a3 3 0 1 1-6 0v-3a4 4 0 0 1 4-4Zm2 3H6v2H4v2h2v2h2v-2h2v-2H8v-2Z"/></svg>',
  school:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 3 1 9l11 6 10-5V9L12 3Zm0 13L3.7 11 12 7l8.3 4L12 16Z"/></svg>',
  brief:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 3h6a2 2 0 0 1 2 2v2h3a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V9a2 2 0 0 1 2-2h3Zm0 4h6V5H9v2Z"/></svg>',
  bolt:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M13 2 3 14h7l-1 8 11-12h-7l0-8Z"/></svg>',
  comfy:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 12h16a2 2 0 0 1 2 2v6h-2v-2H4v2H2v-6a2 2 0 0 1 2-2Z"/></svg>',
  value:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm1 5h-2v2H8v2h3v4H9v2h3v2h2v-2h1v-2h-1v-4h3V9h-3V7Z"/></svg>',
  display16:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 5h18v10H3zM8 19h8v-2H8z"/></svg>',
  display15:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 6h16v9H4zM9 19h6v-2H9z"/></svg>',
  display14:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M5 7h14v8H5zM10 19h4v-2h-4z"/></svg>',
  desk:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M2 10h20v4h-2v6h-2v-6H6v6H4v-6H2v-4Z"/></svg>',
  campus:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M2 10 12 5l10 5-10 5-10-5Zm3 5h14v4H5v-4Z"/></svg>',
  sheets:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 3h10a2 2 0 0 1 2 2v14l-5-3-5 3V5a2 2 0  1 1 2-2Z"/></svg>',
  trophy:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 4h16v3h2a5 5 0 0 1-5 5h-2a4 4 0 0 1-8 0H5A5 5 0 0 1 3 7h1V4Zm6 12h4v2h-4v-2Z"/></svg>',
  bulb:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a7 7 0 0 1 4 13v3h-8v-3a7 7 0 0 1 4-13Zm-2 18h4v2h-4v-2Z"/></svg>',
  home:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 11 12 4l9 7v8h-6v-5H9v5H3v-8Z"/></svg>',
  office:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 3h8v18H4zM14 7h6v14h-6z"/></svg>',
  rocket:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2c4 0 7 3 7 7l-4 4-3-1-1-3 4-4C14 3 12 2 12 2ZM5 19l2-5 3 3-5 2Z"/></svg>',
  check:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>',
  toolbox:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 7V5a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2h3a2 2 0 0 1 2 2v9H2V9a2 2 0 0 1 2-2h3Zm2 0h6V5H9v2Z"/></svg>',
  target:'<svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10h-2a8 8 0 1 1-8-8V2Zm0 4a6 6 0 1 0 6 6h-2a4 4 0 1 1-4-4V6Z"/></svg>'
};

function qs(id){ return document.getElementById(id); }
function toDataUrl(file, cb){ const r = new FileReader(); r.onload = ()=> cb(r.result); r.readAsDataURL(file); }

/* UI state */
let _CFG = null;
let _currentIconTarget = null;

/* Render локални прашања */
function renderQuestions(list){
  const wrap = qs('qWrap'); wrap.innerHTML = '';
  list.forEach((q, qi)=>{
    const el = document.createElement('div');
    el.className = 'q-block';
    el.innerHTML = `
      <label>Наслов (П${qi+1})</label>
      <input data-type="qtitle" data-qi="${qi}" value="${(q.title||'').replace(/"/g,'&quot;')}" />
      <div class="small">Condition: ${q.condition ? q.condition : '—'}</div>
      <div class="small">Одговори:</div>
      <div data-answers="${qi}"></div>
      <div class="row-btns" style="margin-top:8px">
        <button class="btn" data-add="${qi}">Додај одговор</button>
        ${qi<list.length-1?'<button class="btn" data-down="'+qi+'">Помести надолу</button>':''}
        ${qi>0?'<button class="btn" data-up="'+qi+'">Помести нагоре</button>':''}
        ${q.condition!=="lead" ? '<button class="btn" data-del="'+qi+'">Избриши прашање</button>' : ''}
      </div>
    `;
    wrap.appendChild(el);
    const host = el.querySelector(`[data-answers="${qi}"]`);
    (q.answers||[]).forEach((a, ai)=>{
      const row = document.createElement('div');
      row.className = 'ans-row';
      row.innerHTML = `
        <input data-type="atext" data-qi="${qi}" data-ai="${ai}" value="${(a.text||'').replace(/"/g,'&quot;')}" />
        <div class="inline-split">
          <input data-type="aicon" data-qi="${qi}" data-ai="${ai}" placeholder="икона key (локална) или празно" value="${a.icon||''}" style="width:180px" />
          <input data-type="asvg" data-qi="${qi}" data-ai="${ai}" placeholder="Custom SVG (залепи .svg markup)" value="${(a.customSvg||'').replace(/"/g,'&quot;')}" style="width:300px" />
        </div>
        <button class="btn" data-del-answer="${qi}:${ai}">Избриши</button>
      `;
      host.appendChild(row);
    });
  });
  renderIconLibraryLocal('');
}

/* Локални икони (статички) */
function renderIconLibraryLocal(filter){
  const lib = qs('iconLibraryLocal'); lib.innerHTML = '';
  const keys = Object.keys(ICONS_LOCAL).filter(k => !filter || k.includes(filter.toLowerCase()));
  keys.forEach(k=>{
    const btn = document.createElement('button');
    btn.className = 'icon-btn';
    btn.innerHTML = ICONS_LOCAL[k];
    btn.title = k;
    btn.onclick = ()=>{
      if(!_currentIconTarget){ alert('Избери поле „икона key“ кај одговор за да ја залепиш.'); return; }
      const {qi, ai} = _currentIconTarget;
      _CFG.questions[qi].answers[ai].icon = k;
      const input = document.querySelector(`input[data-type="aicon"][data-qi="${qi}"][data-ai="${ai}"]`);
      if(input) input.value = k;
    };
    lib.appendChild(btn);
  });
}

/* External Tabler icons via Iconify */
const ICONIFY_COLLECTION = 'tabler';
const ICONIFY_CACHE_KEY = 'iconify_tabler_cache';
const ICONIFY_CACHE_MS = 24*60*60*1000;

async function fetchTablerList(){
  // колекција (име → не враќа SVG, туку мапа)
  const cached = JSON.parse(localStorage.getItem(ICONIFY_CACHE_KEY)||'null');
  if(cached && (Date.now()-cached.time)<ICONIFY_CACHE_MS) return cached.names;
  const res = await fetch(`https://api.iconify.design/collection?prefix=${ICONIFY_COLLECTION}`);
  const json = await res.json();
  const names = Object.keys(json.icons||{});
  localStorage.setItem(ICONIFY_CACHE_KEY, JSON.stringify({time:Date.now(), names}));
  return names;
}
async function renderIconLibraryExternal(q){
  const lib = qs('iconLibraryExt'); lib.innerHTML='';
  const query = (q||'').trim().toLowerCase();
  const names = await fetchTablerList();
  const filtered = names.filter(n=> n.includes(query)).slice(0,180);
  if(!filtered.length){ lib.innerHTML = '<div class="small" style="grid-column:1/-1">Нема резултати.</div>'; return; }
  for(const name of filtered){
    const btn = document.createElement('button');
    btn.className = 'icon-btn'; btn.title = name;
    try{
      // преземи SVG за преглед
      const svgTxt = await (await fetch(`https://api.iconify.design/${ICONIFY_COLLECTION}/${name}.svg`)).text();
      btn.innerHTML = svgTxt;
      btn.onclick = ()=>{
        if(!_currentIconTarget){ alert('Избери поле „икона key“ или постави Custom SVG кај одговор.'); return; }
        const {qi, ai} = _currentIconTarget;
        _CFG.questions[qi].answers[ai].customSvg = svgTxt; // директно SVG
        const input = document.querySelector(`input[data-type="asvg"][data-qi="${qi}"][data-ai="${ai}"]`);
        if(input) input.value = svgTxt;
      };
    }catch(e){ btn.textContent = name; }
    lib.appendChild(btn);
  }
}

/* Fill/Collect и Save/Load (исто како претходно) */
function fill(cfg){
  qs('cfg_logo_url').value = cfg.logo?.url || '';
  qs('preview_logo').src = cfg.logo?.data || cfg.logo?.url || '';
  qs('cfg_hero_title').value = cfg.hero?.title || '';
  qs('cfg_hero_sub').value = cfg.hero?.sub || '';
  qs('cfg_start_cta').value = cfg.hero?.cta || '';
  qs('cfg_hero_img_url').value = cfg.hero?.image?.url || '';
  qs('preview_hero').src = cfg.hero?.image?.data || cfg.hero?.image?.url || '';
  qs('cfg_finish_cta').value = cfg.finish?.cta || '';
  qs('u_legion').value = cfg.productUrls.legion || '';
  qs('u_thinkbook14').value = cfg.productUrls.thinkbook14 || '';
  qs('u_thinkpadE16').value = cfg.productUrls.thinkpadE16 || '';
  qs('u_v15').value = cfg.productUrls.v15 || '';
  qs('u_fallback').value = cfg.productUrls.fallback || '';
  qs('i_legion').value = cfg.productImages.legion || '';
  qs('i_thinkbook14').value = cfg.productImages.thinkbook14 || '';
  qs('i_thinkpadE16').value = cfg.productImages.thinkpadE16 || '';
  qs('i_v15').value = cfg.productImages.v15 || '';
  _CFG = JSON.parse(JSON.stringify(cfg));
  renderQuestions(_CFG.questions);
}
function collect(){
  const cfg = JSON.parse(JSON.stringify(_CFG));
  cfg.logo.url = qs('cfg_logo_url').value.trim();
  cfg.hero.title = qs('cfg_hero_title').value.trim();
  cfg.hero.sub = qs('cfg_hero_sub').value.trim();
  cfg.hero.cta = qs('cfg_start_cta').value.trim();
  cfg.hero.image.url = qs('cfg_hero_img_url').value.trim();
  cfg.finish.cta = qs('cfg_finish_cta').value.trim();
  cfg.productUrls.legion = qs('u_legion').value.trim();
  cfg.productUrls.thinkbook14 = qs('u_thinkbook14').value.trim();
  cfg.productUrls.thinkpadE16 = qs('u_thinkpadE16').value.trim();
  cfg.productUrls.v15 = qs('u_v15').value.trim();
  cfg.productUrls.fallback = qs('u_fallback').value.trim();
  cfg.productImages.legion = qs('i_legion').value.trim();
  cfg.productImages.thinkbook14 = qs('i_thinkbook14').value.trim();
  cfg.productImages.thinkpadE16 = qs('i_thinkpadE16').value.trim();
  cfg.productImages.v15 = qs('i_v15').value.trim();
  return cfg;
}
function save(){ localStorage.setItem('lenovoQuizConfig', JSON.stringify(collect())); alert('Зачувано ✅'); }
function load(){
  const raw = localStorage.getItem('lenovoQuizConfig');
  if(!raw){ fill(DEFAULT); alert('Нема локална конфигурација — вчитана фабричка.'); return; }
  try{ fill(JSON.parse(raw)); }catch(e){ fill(DEFAULT); alert('Грешка при читање — вчитана фабричка.'); }
}
function exportJSON(){
  const blob = new Blob([JSON.stringify(collect(), null, 2)], {type:'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'lenovoQuizConfig.json'; a.click();
}
function importJSON(file){
  const r = new FileReader();
  r.onload = ()=>{ try{ const cfg = JSON.parse(r.result); fill(cfg); localStorage.setItem('lenovoQuizConfig', JSON.stringify(cfg)); alert('Увезено ✅'); }catch(e){ alert('Невалиден JSON'); } };
  r.readAsText(file);
}

/* Events */
qs('btnSave').onclick = save; qs('btnSave2').onclick = save; qs('btnLoad').onclick = load; qs('btnExport').onclick = exportJSON;
qs('fileImport').onchange = (e)=> importJSON(e.target.files[0]);
qs('cfg_logo_file').onchange = (e)=>{ const f=e.target.files[0]; if(!f) return; toDataUrl(f, data=>{ _CFG.logo.data = data; qs('preview_logo').src=data; }); };
qs('cfg_hero_img_file').onchange = (e)=>{ const f=e.target.files[0]; if(!f) return; toDataUrl(f, data=>{ _CFG.hero.image.data = data; qs('preview_hero').src=data; }); };

document.addEventListener('input', (e)=>{
  const el = e.target;
  const qi = Number(el.dataset.qi), ai = Number(el.dataset.ai);
  if(el.dataset.type === 'qtitle'){ _CFG.questions[qi].title = el.value; }
  if(el.dataset.type === 'atext'){ _CFG.questions[qi].answers[ai].text = el.value; }
  if(el.dataset.type === 'aicon'){ _currentIconTarget = {qi, ai}; _CFG.questions[qi].answers[ai].icon = el.value.trim(); }
  if(el.dataset.type === 'asvg'){ _CFG.questions[qi].answers[ai].customSvg = el.value; }
  if(el.id==='iconSearchLocal'){ renderIconLibraryLocal(el.value.trim()); }
});
document.addEventListener('click', (e)=>{
  const a = e.target.dataset.add, del=e.target.dataset.del, up=e.target.dataset.up, down=e.target.dataset.down, delAns=e.target.dataset.delAnswer;
  if(a){ const i=Number(a); _CFG.questions[i].answers.push({text:'Нов одговор', icon:'', customSvg:''}); renderQuestions(_CFG.questions); }
  if(typeof del!=='undefined'){ const i=Number(del); _CFG.questions.splice(i,1); renderQuestions(_CFG.questions); }
  if(up){ const i=Number(up); const t=_CFG.questions[i]; _CFG.questions.splice(i,1); _CFG.questions.splice(i-1,0,t); renderQuestions(_CFG.questions); }
  if(down){ const i=Number(down); const t=_CFG.questions[i]; _CFG.questions.splice(i,1); _CFG.questions.splice(i+1,0,t); renderQuestions(_CFG.questions); }
  if(delAns){ const [qi,ai]=delAns.split(':').map(Number); _CFG.questions[qi].answers.splice(ai,1); renderQuestions(_CFG.questions); }
});

/* Tabs: локални / external */
function showPane(id, yes){ document.getElementById(id).classList.toggle('hidden', !yes); }
qs('tabLocal').onclick = ()=>{ qs('tabLocal').classList.add('active'); qs('tabExternal').classList.remove('active'); showPane('localIconsPane', true); showPane('externalIconsPane', false); };
qs('tabExternal').onclick = ()=>{ qs('tabExternal').classList.add('active'); qs('tabLocal').classList.remove('active'); showPane('localIconsPane', false); showPane('externalIconsPane', true); };

qs('btnFetchExt').onclick = ()=> renderIconLibraryExternal(qs('iconSearchExt').value||'');

/* Старт */
fill(DEFAULT);
</script>
</body>
</html>
